<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Regalos en Efectivo - Boda de Iluminada & George</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* Estilos para el header con selector de idiomas */
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      position: relative;
      overflow: visible;
    }
    
    .header-left {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    
    .header-left .home-link {
      flex-shrink: 0;
      order: -1;
    }
    
    .header-left h1 {
      margin: 0;
      flex: 1;
    }

    /* Estilos para el selector de idiomas */
    .language-selector {
      position: relative;
      margin-left: 20px;
      z-index: 1000;
      overflow: visible;
    }
    
    .language-selector-wrapper {
      position: relative;
      overflow: visible;
    }
    
    .language-selector-dropdown {
      position: relative;
      display: inline-block;
      overflow: visible;
    }
    
    .language-selector-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      min-width: 120px;
    }
    
    .language-selector-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .language-selector-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e1e5e9;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(20px);
      min-width: 160px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 10000;
      overflow: visible;
    }
    
    .language-selector-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .language-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #333;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 1px solid #f5f5f5;
    }
    
    .language-option:last-child {
      border-bottom: none;
    }
    
    .language-option:hover {
      background: #f8f9fa;
      color: #007bff;
    }
    
    .language-option.active {
      background: #e3f2fd;
      color: #1976d2;
      font-weight: 600;
    }
    
    /* Asegurar que el header tenga el espacio correcto */
    header {
      position: relative;
      padding: 60px 20px 40px 20px;
      min-height: 120px;
      z-index: 1000;
      overflow: visible !important;
    }

    /* Asegurar que el body permita overflow visible */
    body {
      overflow-x: hidden;
      overflow-y: visible;
    }

    /* Estilos para el contenido principal */
    main {
      margin-top: 40px;
      padding: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Estilos para la sección de regalos */
    .gifts-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      margin-bottom: 30px;
    }

    .gifts-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .gifts-header h2 {
      color: var(--primary-color);
      font-size: 2.5rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .gifts-header p {
      color: var(--text-light);
      font-size: 1.1rem;
      line-height: 1.6;
    }

    /* Estilos para las opciones de cantidad */
    .amount-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .amount-option {
      background: white;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .amount-option:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(139, 90, 150, 0.15);
    }

    .amount-option.selected {
      border-color: var(--primary-color);
      background: linear-gradient(135deg, rgba(139, 90, 150, 0.1), rgba(212, 165, 165, 0.1));
    }

    .amount-option .amount {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 5px;
    }

    .amount-option .label {
      font-size: 0.9rem;
      color: var(--text-light);
      font-weight: 500;
    }

    /* Estilos para cantidad personalizada */
    .custom-amount {
      background: white;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .custom-amount h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .custom-amount-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .custom-amount-input input {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
    }

    .custom-amount-input input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(139, 90, 150, 0.1);
    }

    .custom-amount-input span {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-color);
    }

    /* Estilos para el formulario de información */
    .donor-info {
      background: white;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .donor-info h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-color);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(139, 90, 150, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* Estilos para el botón de pago */
    .payment-section {
      text-align: center;
      margin-top: 30px;
    }

    .payment-summary {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .payment-summary h3 {
      margin: 0 0 10px 0;
      font-size: 1.3rem;
    }

    .payment-summary .amount {
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
    }

    .stripe-button {
      background: linear-gradient(135deg, #635bff, #00d4aa);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(99, 91, 255, 0.3);
    }

    .stripe-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 91, 255, 0.4);
    }

    .stripe-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Estilos para mensajes */
    .message {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .amount-options {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .gifts-section {
        padding: 20px;
      }

      .gifts-header h2 {
        font-size: 2rem;
      }

      .custom-amount-input {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="header-left">
        <a href="index-i18n-fixed.html" class="home-link">
          <i class="fas fa-home"></i>
          <span>Inicio</span>
        </a>
        <h1>Regalos en Efectivo</h1>
      </div>
      <div class="language-selector">
        <div class="language-selector-wrapper">
          <div class="language-selector-dropdown">
            <button class="language-selector-toggle" id="language-toggle" aria-label="Select language">
              <span class="current-language">
                <span class="flag">🇪🇸</span>
                <span class="name">Español</span>
              </span>
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="language-selector-menu" id="language-menu">
              <button class="language-option active" data-lang="es">
                <span class="flag">🇪🇸</span>
                <span class="name">Español</span>
              </button>
              <button class="language-option" data-lang="en">
                <span class="flag">🇬🇧</span>
                <span class="name">English</span>
              </button>
              <button class="language-option" data-lang="fr">
                <span class="flag">🇫🇷</span>
                <span class="name">Français</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="gifts-section">
      <div class="gifts-header">
        <h2>
          <i class="fas fa-gift"></i>
          Regalos en Efectivo
        </h2>
        <p>
          Si prefieres hacer un regalo en efectivo, puedes elegir una cantidad fija o personalizada. 
          Tu generosidad nos ayudará a comenzar nuestra nueva vida juntos.
        </p>
      </div>

      <div id="messageContainer"></div>

      <!-- Opciones de cantidad fija -->
      <div class="amount-options">
        <div class="amount-option" data-amount="25">
          <div class="amount">€25</div>
          <div class="label">Regalo pequeño</div>
        </div>
        <div class="amount-option" data-amount="50">
          <div class="amount">€50</div>
          <div class="label">Regalo medio</div>
        </div>
        <div class="amount-option" data-amount="100">
          <div class="amount">€100</div>
          <div class="label">Regalo generoso</div>
        </div>
        <div class="amount-option" data-amount="200">
          <div class="amount">€200</div>
          <div class="label">Regalo especial</div>
        </div>
      </div>

      <!-- Cantidad personalizada -->
      <div class="custom-amount">
        <h3>
          <i class="fas fa-edit"></i>
          Cantidad Personalizada
        </h3>
        <div class="custom-amount-input">
          <input type="number" id="customAmount" placeholder="0" min="1" max="1000">
          <span>€</span>
        </div>
      </div>

      <!-- Sección de pago -->
      <div class="payment-section">
        <div class="payment-summary" id="paymentSummary" style="display: none;">
          <h3>Resumen del Regalo</h3>
          <p class="amount" id="selectedAmount">€0</p>
        </div>
        <button class="stripe-button" id="payButton" disabled>
          <i class="fas fa-credit-card"></i>
          Proceder al Pago
        </button>
      </div>

      <!-- Información del donante -->
      <div class="donor-info">
        <h3>
          <i class="fas fa-user"></i>
          Tu Información
        </h3>
        <div class="form-group">
          <label for="donorName">Nombre completo *</label>
          <input type="text" id="donorName" required>
        </div>
        <div class="form-group">
          <label for="donorEmail">Email *</label>
          <input type="email" id="donorEmail" required>
        </div>
        <div class="form-group">
          <label for="donorMessage">Mensaje para los novios (opcional)</label>
          <textarea id="donorMessage" placeholder="Escribe un mensaje especial para Iluminada y George..."></textarea>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Configuración de Stripe (usar claves de prueba)
    const stripe = Stripe('pk_test_51S3mEM1VZvSGk6xq2xUlkklkqrZtPH8zSPbZJRAARzmLLyDUBvCzjp1iEzn3xBYpEvgIGDHSgDd4McnqokupordX00JH8BtacP');
    
    let selectedAmount = 0;
    let selectedOption = null;

    // Traducciones
    const translations = {
      es: {
        'gifts:title': 'Regalos en Efectivo',
        'gifts:subtitle': 'Si prefieres hacer un regalo en efectivo, puedes elegir una cantidad fija o personalizada. Tu generosidad nos ayudará a comenzar nuestra nueva vida juntos.',
        'gifts:fixedAmounts': 'Cantidades Fijas',
        'gifts:customAmount': 'Cantidad Personalizada',
        'gifts:donorInfo': 'Tu Información',
        'gifts:donorName': 'Nombre completo',
        'gifts:donorEmail': 'Email',
        'gifts:donorMessage': 'Mensaje para los novios (opcional)',
        'gifts:paymentSummary': 'Resumen del Regalo',
        'gifts:proceedPayment': 'Proceder al Pago',
        'gifts:smallGift': 'Regalo pequeño',
        'gifts:mediumGift': 'Regalo medio',
        'gifts:generousGift': 'Regalo generoso',
        'gifts:specialGift': 'Regalo especial',
        'gifts:messagePlaceholder': 'Escribe un mensaje especial para Iluminada y George...',
        'gifts:selectAmount': 'Por favor, selecciona una cantidad',
        'gifts:fillRequired': 'Por favor, completa todos los campos obligatorios',
        'gifts:processing': 'Procesando pago...',
        'gifts:error': 'Error al procesar el pago'
      },
      en: {
        'gifts:title': 'Cash Gifts',
        'gifts:subtitle': 'If you prefer to give a cash gift, you can choose a fixed or custom amount. Your generosity will help us start our new life together.',
        'gifts:fixedAmounts': 'Fixed Amounts',
        'gifts:customAmount': 'Custom Amount',
        'gifts:donorInfo': 'Your Information',
        'gifts:donorName': 'Full name',
        'gifts:donorEmail': 'Email',
        'gifts:donorMessage': 'Message for the couple (optional)',
        'gifts:paymentSummary': 'Gift Summary',
        'gifts:proceedPayment': 'Proceed to Payment',
        'gifts:smallGift': 'Small gift',
        'gifts:mediumGift': 'Medium gift',
        'gifts:generousGift': 'Generous gift',
        'gifts:specialGift': 'Special gift',
        'gifts:messagePlaceholder': 'Write a special message for Iluminada and George...',
        'gifts:selectAmount': 'Please select an amount',
        'gifts:fillRequired': 'Please fill in all required fields',
        'gifts:processing': 'Processing payment...',
        'gifts:error': 'Error processing payment'
      },
      fr: {
        'gifts:title': 'Cadeaux en Espèces',
        'gifts:subtitle': 'Si vous préférez faire un cadeau en espèces, vous pouvez choisir un montant fixe ou personnalisé. Votre générosité nous aidera à commencer notre nouvelle vie ensemble.',
        'gifts:fixedAmounts': 'Montants Fixes',
        'gifts:customAmount': 'Montant Personnalisé',
        'gifts:donorInfo': 'Vos Informations',
        'gifts:donorName': 'Nom complet',
        'gifts:donorEmail': 'Email',
        'gifts:donorMessage': 'Message pour les mariés (optionnel)',
        'gifts:paymentSummary': 'Résumé du Cadeau',
        'gifts:proceedPayment': 'Procéder au Paiement',
        'gifts:smallGift': 'Petit cadeau',
        'gifts:mediumGift': 'Cadeau moyen',
        'gifts:generousGift': 'Cadeau généreux',
        'gifts:specialGift': 'Cadeau spécial',
        'gifts:messagePlaceholder': 'Écrivez un message spécial pour Iluminada et George...',
        'gifts:selectAmount': 'Veuillez sélectionner un montant',
        'gifts:fillRequired': 'Veuillez remplir tous les champs obligatoires',
        'gifts:processing': 'Traitement du paiement...',
        'gifts:error': 'Erreur lors du traitement du paiement'
      }
    };

    let currentLanguage = 'es';

    function translate(key) {
      return translations[currentLanguage]?.[key] || key;
    }

    function updatePageContent() {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = translate(key);
        if (translation !== key) {
          element.textContent = translation;
        }
      });
    }

    // Funciones para manejar la selección de cantidad
    function selectAmount(amount, element) {
      selectedAmount = amount;
      selectedOption = element;
      
      // Remover selección anterior
      document.querySelectorAll('.amount-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      // Agregar selección actual
      if (element) {
        element.classList.add('selected');
      }
      
      // Limpiar cantidad personalizada
      document.getElementById('customAmount').value = '';
      
      updatePaymentSummary();
      checkFormValidity();
    }

    function handleCustomAmount() {
      const customAmount = parseFloat(document.getElementById('customAmount').value);
      
      if (customAmount && customAmount > 0) {
        selectedAmount = customAmount;
        selectedOption = null;
        
        // Remover selección de opciones fijas
        document.querySelectorAll('.amount-option').forEach(option => {
          option.classList.remove('selected');
        });
        
        updatePaymentSummary();
        checkFormValidity();
      } else {
        selectedAmount = 0;
        updatePaymentSummary();
        checkFormValidity();
      }
    }

    function updatePaymentSummary() {
      const summary = document.getElementById('paymentSummary');
      const amountDisplay = document.getElementById('selectedAmount');
      
      if (selectedAmount > 0) {
        summary.style.display = 'block';
        amountDisplay.textContent = `€${selectedAmount}`;
      } else {
        summary.style.display = 'none';
      }
    }

    function checkFormValidity() {
      const name = document.getElementById('donorName').value.trim();
      const email = document.getElementById('donorEmail').value.trim();
      const payButton = document.getElementById('payButton');
      
      if (selectedAmount > 0 && name && email) {
        payButton.disabled = false;
      } else {
        payButton.disabled = true;
      }
    }

    function showMessage(message, type = 'info') {
      const container = document.getElementById('messageContainer');
      container.innerHTML = `<div class="message ${type}">${message}</div>`;
      
      // Auto-ocultar después de 5 segundos
      setTimeout(() => {
        container.innerHTML = '';
      }, 5000);
    }

    async function processPayment() {
      if (!selectedAmount || selectedAmount <= 0) {
        showMessage(translate('gifts:selectAmount'), 'error');
        return;
      }

      const name = document.getElementById('donorName').value.trim();
      const email = document.getElementById('donorEmail').value.trim();
      const message = document.getElementById('donorMessage').value.trim();

      if (!name || !email) {
        showMessage(translate('gifts:fillRequired'), 'error');
        return;
      }

      const payButton = document.getElementById('payButton');
      payButton.disabled = true;
      payButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${translate('gifts:processing')}`;

      try {
        // Crear sesión de pago en el backend
        const response = await fetch('/api/create-payment-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            amount: Math.round(selectedAmount * 100), // Convertir a centavos
            currency: 'eur',
            donorName: name,
            donorEmail: email,
            donorMessage: message,
            successUrl: `${window.location.origin}/regalos-efectivo.html?success=true`,
            cancelUrl: `${window.location.origin}/regalos-efectivo.html?canceled=true`
          })
        });

        const session = await response.json();

        if (session.error) {
          throw new Error(session.error);
        }

        // Redirigir a Stripe Checkout
        const { error } = await stripe.redirectToCheckout({
          sessionId: session.id
        });

        if (error) {
          throw new Error(error.message);
        }

      } catch (error) {
        console.error('Error:', error);
        showMessage(translate('gifts:error') + ': ' + error.message, 'error');
        
        // Restaurar botón
        payButton.disabled = false;
        payButton.innerHTML = `<i class="fas fa-credit-card"></i> ${translate('gifts:proceedPayment')}`;
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Opciones de cantidad fija
      document.querySelectorAll('.amount-option').forEach(option => {
        option.addEventListener('click', () => {
          const amount = parseFloat(option.dataset.amount);
          selectAmount(amount, option);
        });
      });

      // Cantidad personalizada
      document.getElementById('customAmount').addEventListener('input', handleCustomAmount);

      // Validación de formulario
      document.getElementById('donorName').addEventListener('input', checkFormValidity);
      document.getElementById('donorEmail').addEventListener('input', checkFormValidity);

      // Botón de pago
      document.getElementById('payButton').addEventListener('click', processPayment);

      // Manejar parámetros de URL
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('success') === 'true') {
        showMessage('¡Gracias por tu generoso regalo! Los novios estarán muy agradecidos.', 'success');
      } else if (urlParams.get('canceled') === 'true') {
        showMessage('El pago fue cancelado. Puedes intentar nuevamente cuando quieras.', 'info');
      }

      // Configurar selector de idiomas
      const toggle = document.getElementById('language-toggle');
      const menu = document.getElementById('language-menu');
      
      if (toggle && menu) {
        toggle.addEventListener('click', (e) => {
          e.stopPropagation();
          menu.classList.toggle('show');
        });
        
        document.addEventListener('click', (e) => {
          if (!toggle.contains(e.target)) {
            menu.classList.remove('show');
          }
        });
        
        document.querySelectorAll('.language-option').forEach(option => {
          option.addEventListener('click', (e) => {
            e.preventDefault();
            const lang = option.getAttribute('data-lang');
            changeLanguage(lang);
            menu.classList.remove('show');
          });
        });
      }
    });

    function changeLanguage(lang) {
      currentLanguage = lang;
      updatePageContent();
      
      // Actualizar selector
      const toggle = document.getElementById('language-toggle');
      const currentLang = {
        es: { name: 'Español', flag: '🇪🇸' },
        en: { name: 'English', flag: '🇬🇧' },
        fr: { name: 'Français', flag: '🇫🇷' }
      }[lang];
      
      if (toggle) {
        toggle.innerHTML = `
          <span class="current-language">
            <span class="flag">${currentLang.flag}</span>
            <span class="name">${currentLang.name}</span>
          </span>
          <i class="fas fa-chevron-down"></i>
        `;
      }
      
      // Actualizar opciones activas
      document.querySelectorAll('.language-option').forEach(option => {
        const optionLang = option.getAttribute('data-lang');
        if (optionLang === lang) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }
  </script>
</body>
</html>
