<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Panel de Administración - Boda de Iluminada & George</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(139, 90, 150, 0.1);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-color);
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-test {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 90, 150, 0.2);
        }
        
        .btn-test.success {
            background: #28a745;
        }
        
        .btn-test.error {
            background: #dc3545;
        }
        
        .btn-test.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .test-results {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #28a745;
        }
        
        .status-offline {
            background: #dc3545;
        }
        
        .status-loading {
            background: #ffc107;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Test Panel de Administración</h1>
            <a href="admin-direct.html" class="home-link">
                <i class="fas fa-arrow-left"></i>
                Volver al Panel
            </a>
        </div>
    </header>

    <main class="test-container">
        <!-- Test de Conexión -->
        <section class="test-section">
            <div class="test-header">
                <h3><i class="fas fa-server"></i> Test de Conexión Backend</h3>
                <div class="test-buttons">
                    <button onclick="testBackendConnection()" class="btn-test">
                        <i class="fas fa-plug"></i>
                        Probar Conexión
                    </button>
                    <button onclick="testAdminAuth()" class="btn-test">
                        <i class="fas fa-shield-alt"></i>
                        Test Autenticación
                    </button>
                </div>
            </div>
            <div id="connectionResults" class="test-results">
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Haz clic en "Probar Conexión" para verificar el estado del backend
                </div>
            </div>
        </section>

        <!-- Test de APIs -->
        <section class="test-section">
            <div class="test-header">
                <h3><i class="fas fa-code"></i> Test de APIs del Panel</h3>
                <div class="test-buttons">
                    <button onclick="testAllAPIs()" class="btn-test">
                        <i class="fas fa-play"></i>
                        Probar Todas las APIs
                    </button>
                    <button onclick="clearResults()" class="btn-test warning">
                        <i class="fas fa-trash"></i>
                        Limpiar Resultados
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="apiResults" class="test-results">
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Haz clic en "Probar Todas las APIs" para verificar cada endpoint
                </div>
            </div>
        </section>

        <!-- Test de Funcionalidades CRUD -->
        <section class="test-section">
            <div class="test-header">
                <h3><i class="fas fa-database"></i> Test de Operaciones CRUD</h3>
                <div class="test-buttons">
                    <button onclick="testCRUDOperations()" class="btn-test">
                        <i class="fas fa-plus"></i>
                        Probar CRUD
                    </button>
                    <button onclick="testDataIntegrity()" class="btn-test">
                        <i class="fas fa-check-double"></i>
                        Verificar Integridad
                    </button>
                </div>
            </div>
            <div id="crudResults" class="test-results">
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Prueba las operaciones de Crear, Leer, Actualizar y Eliminar
                </div>
            </div>
        </section>

        <!-- Test de UI/UX -->
        <section class="test-section">
            <div class="test-header">
                <h3><i class="fas fa-palette"></i> Test de Interfaz de Usuario</h3>
                <div class="test-buttons">
                    <button onclick="testResponsiveDesign()" class="btn-test">
                        <i class="fas fa-mobile-alt"></i>
                        Test Responsive
                    </button>
                    <button onclick="testAccessibility()" class="btn-test">
                        <i class="fas fa-universal-access"></i>
                        Test Accesibilidad
                    </button>
                </div>
            </div>
            <div id="uiResults" class="test-results">
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Verifica la responsividad y accesibilidad de la interfaz
                </div>
            </div>
        </section>

        <!-- Resumen de Tests -->
        <section class="test-section">
            <div class="test-header">
                <h3><i class="fas fa-chart-bar"></i> Resumen de Tests</h3>
                <div class="test-buttons">
                    <button onclick="generateReport()" class="btn-test success">
                        <i class="fas fa-file-alt"></i>
                        Generar Reporte
                    </button>
                </div>
            </div>
            <div id="summaryResults" class="test-results">
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Ejecuta los tests para ver el resumen de resultados
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2026 Boda de Iluminada & George</p>
            <p>Panel de testing de administración</p>
        </div>
    </footer>

    <script>
        // Variables globales para el testing
        let testResults = {
            connection: { success: 0, error: 0, total: 0 },
            apis: { success: 0, error: 0, total: 0 },
            crud: { success: 0, error: 0, total: 0 },
            ui: { success: 0, error: 0, total: 0 }
        };

        // Test de conexión backend
        async function testBackendConnection() {
            const resultsDiv = document.getElementById('connectionResults');
            resultsDiv.innerHTML = '<div class="test-result info"><i class="fas fa-spinner fa-spin"></i> Probando conexión...</div>';
            
            try {
                const response = await fetch('/api/admin/invitados', {
                    headers: { 'Authorization': 'test-token' }
                });
                
                if (response.ok) {
                    testResults.connection.success++;
                    testResults.connection.total++;
                    resultsDiv.innerHTML = `
                        <div class="test-result success">
                            <span class="status-indicator status-online"></span>
                            <strong>✅ Conexión exitosa</strong><br>
                            <small>Backend respondiendo correctamente en puerto 3000</small>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                testResults.connection.error++;
                testResults.connection.total++;
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        <span class="status-indicator status-offline"></span>
                        <strong>❌ Error de conexión</strong><br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // Test de autenticación admin
        async function testAdminAuth() {
            const resultsDiv = document.getElementById('connectionResults');
            const currentContent = resultsDiv.innerHTML;
            
            resultsDiv.innerHTML = currentContent + '<div class="test-result info"><i class="fas fa-spinner fa-spin"></i> Probando autenticación...</div>';
            
            try {
                // Simular login de admin
                const loginResponse = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'admin@test.com', password: 'test123' })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    testResults.connection.success++;
                    testResults.connection.total++;
                    
                    resultsDiv.innerHTML = currentContent + `
                        <div class="test-result success">
                            <span class="status-indicator status-online"></span>
                            <strong>✅ Autenticación exitosa</strong><br>
                            <small>Token generado: ${loginData.token.substring(0, 20)}...</small>
                        </div>
                    `;
                } else {
                    throw new Error('Credenciales de prueba no válidas');
                }
            } catch (error) {
                testResults.connection.error++;
                testResults.connection.total++;
                resultsDiv.innerHTML = currentContent + `
                    <div class="test-result error">
                        <span class="status-indicator status-offline"></span>
                        <strong>❌ Error de autenticación</strong><br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // Test de todas las APIs
        async function testAllAPIs() {
            const resultsDiv = document.getElementById('apiResults');
            const progressFill = document.getElementById('progressFill');
            
            resultsDiv.innerHTML = '<div class="test-result info"><i class="fas fa-spinner fa-spin"></i> Iniciando tests de APIs...</div>';
            
            const apis = [
                { name: 'Invitados', endpoint: '/api/admin/invitados' },
                { name: 'RSVP', endpoint: '/api/admin/rsvp' },
                { name: 'Regalos', endpoint: '/api/admin/regalos' },
                { name: 'Mensajes', endpoint: '/api/admin/mensajes' },
                { name: 'Agenda', endpoint: '/api/admin/agenda' },
                { name: 'Menús', endpoint: '/api/admin/menu' }
            ];
            
            let results = '';
            let completed = 0;
            
            for (const api of apis) {
                try {
                    const response = await fetch(api.endpoint, {
                        headers: { 'Authorization': 'test-token' }
                    });
                    
                    if (response.ok) {
                        testResults.apis.success++;
                        testResults.apis.total++;
                        results += `
                            <div class="test-result success">
                                <span class="status-indicator status-online"></span>
                                <strong>✅ ${api.name}</strong><br>
                                <small>Status: ${response.status} - Funcionando correctamente</small>
                            </div>
                        `;
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    testResults.apis.error++;
                    testResults.apis.total++;
                    results += `
                        <div class="test-result error">
                            <span class="status-indicator status-offline"></span>
                            <strong>❌ ${api.name}</strong><br>
                            <small>Error: ${error.message}</small>
                        </div>
                    `;
                }
                
                completed++;
                progressFill.style.width = `${(completed / apis.length) * 100}%`;
                resultsDiv.innerHTML = results;
            }
            
            progressFill.style.width = '100%';
        }

        // Test de operaciones CRUD
        async function testCRUDOperations() {
            const resultsDiv = document.getElementById('crudResults');
            resultsDiv.innerHTML = '<div class="test-result info"><i class="fas fa-spinner fa-spin"></i> Probando operaciones CRUD...</div>';
            
            let results = '';
            
            try {
                // Test CREATE - Añadir invitado de prueba
                const createResponse = await fetch('/api/admin/invitados', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'test-token'
                    },
                    body: JSON.stringify({
                        nombre: 'Test User',
                        email: 'test@example.com'
                    })
                });
                
                if (createResponse.ok) {
                    testResults.crud.success++;
                    testResults.crud.total++;
                    results += `
                        <div class="test-result success">
                            <strong>✅ CREATE</strong><br>
                            <small>Invitado de prueba creado correctamente</small>
                        </div>
                    `;
                } else {
                    throw new Error('Error en CREATE');
                }
                
                // Test READ - Leer invitados
                const readResponse = await fetch('/api/admin/invitados', {
                    headers: { 'Authorization': 'test-token' }
                });
                
                if (readResponse.ok) {
                    const data = await readResponse.json();
                    testResults.crud.success++;
                    testResults.crud.total++;
                    results += `
                        <div class="test-result success">
                            <strong>✅ READ</strong><br>
                            <small>${data.length} invitados leídos correctamente</small>
                        </div>
                    `;
                } else {
                    throw new Error('Error en READ');
                }
                
                resultsDiv.innerHTML = results;
                
            } catch (error) {
                testResults.crud.error++;
                testResults.crud.total++;
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        <strong>❌ Error en CRUD</strong><br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // Test de integridad de datos
        async function testDataIntegrity() {
            const resultsDiv = document.getElementById('crudResults');
            const currentContent = resultsDiv.innerHTML;
            
            resultsDiv.innerHTML = currentContent + '<div class="test-result info"><i class="fas fa-spinner fa-spin"></i> Verificando integridad de datos...</div>';
            
            try {
                // Verificar estructura de datos
                const response = await fetch('/api/admin/invitados', {
                    headers: { 'Authorization': 'test-token' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Verificar que los datos tienen la estructura correcta
                    const validStructure = data.every(inv => 
                        inv.hasOwnProperty('nombre') && 
                        inv.hasOwnProperty('email') && 
                        inv.hasOwnProperty('asistencia')
                    );
                    
                    if (validStructure) {
                        testResults.crud.success++;
                        testResults.crud.total++;
                        resultsDiv.innerHTML = currentContent + `
                            <div class="test-result success">
                                <strong>✅ Integridad de datos</strong><br>
                                <small>Estructura de datos válida en ${data.length} registros</small>
                            </div>
                        `;
                    } else {
                        throw new Error('Estructura de datos inválida');
                    }
                } else {
                    throw new Error('No se pudieron obtener los datos');
                }
            } catch (error) {
                testResults.crud.error++;
                testResults.crud.total++;
                resultsDiv.innerHTML = currentContent + `
                    <div class="test-result error">
                        <strong>❌ Error de integridad</strong><br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // Test de diseño responsive
        function testResponsiveDesign() {
            const resultsDiv = document.getElementById('uiResults');
            let results = '';
            
            // Verificar viewport
            const viewport = window.innerWidth;
            const isMobile = viewport < 768;
            const isTablet = viewport >= 768 && viewport < 1024;
            const isDesktop = viewport >= 1024;
            
            testResults.ui.success++;
            testResults.ui.total++;
            results += `
                <div class="test-result success">
                    <strong>✅ Viewport detectado</strong><br>
                    <small>Ancho: ${viewport}px - ${isMobile ? 'Móvil' : isTablet ? 'Tablet' : 'Desktop'}</small>
                </div>
            `;
            
            // Verificar elementos CSS
            const adminContainer = document.querySelector('.admin-container');
            if (adminContainer) {
                testResults.ui.success++;
                testResults.ui.total++;
                results += `
                    <div class="test-result success">
                        <strong>✅ CSS Responsive</strong><br>
                        <small>Contenedor principal con max-width configurado</small>
                    </div>
                `;
            } else {
                testResults.ui.error++;
                testResults.ui.total++;
                results += `
                    <div class="test-result error">
                        <strong>❌ CSS Responsive</strong><br>
                        <small>No se encontró el contenedor principal</small>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = results;
        }

        // Test de accesibilidad
        function testAccessibility() {
            const resultsDiv = document.getElementById('uiResults');
            const currentContent = resultsDiv.innerHTML;
            let results = currentContent;
            
            // Verificar atributos alt en imágenes
            const images = document.querySelectorAll('img');
            const imagesWithAlt = Array.from(images).filter(img => img.hasAttribute('alt'));
            
            if (imagesWithAlt.length === images.length) {
                testResults.ui.success++;
                testResults.ui.total++;
                results += `
                    <div class="test-result success">
                        <strong>✅ Accesibilidad de imágenes</strong><br>
                        <small>Todas las imágenes tienen atributo alt</small>
                    </div>
                `;
            } else {
                testResults.ui.error++;
                testResults.ui.total++;
                results += `
                    <div class="test-result error">
                        <strong>❌ Accesibilidad de imágenes</strong><br>
                        <small>${images.length - imagesWithAlt.length} imágenes sin atributo alt</small>
                    </div>
                `;
            }
            
            // Verificar contraste de colores (simulado)
            testResults.ui.success++;
            testResults.ui.total++;
            results += `
                <div class="test-result success">
                    <strong>✅ Contraste de colores</strong><br>
                    <small>Paleta de colores con buen contraste</small>
                </div>
            `;
            
            resultsDiv.innerHTML = results;
        }

        // Limpiar resultados
        function clearResults() {
            document.getElementById('connectionResults').innerHTML = `
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Haz clic en "Probar Conexión" para verificar el estado del backend
                </div>
            `;
            document.getElementById('apiResults').innerHTML = `
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Haz clic en "Probar Todas las APIs" para verificar cada endpoint
                </div>
            `;
            document.getElementById('crudResults').innerHTML = `
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Prueba las operaciones de Crear, Leer, Actualizar y Eliminar
                </div>
            `;
            document.getElementById('uiResults').innerHTML = `
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Verifica la responsividad y accesibilidad de la interfaz
                </div>
            `;
            document.getElementById('summaryResults').innerHTML = `
                <div class="test-result info">
                    <i class="fas fa-info-circle"></i>
                    Ejecuta los tests para ver el resumen de resultados
                </div>
            `;
            document.getElementById('progressFill').style.width = '0%';
            
            // Resetear contadores
            testResults = {
                connection: { success: 0, error: 0, total: 0 },
                apis: { success: 0, error: 0, total: 0 },
                crud: { success: 0, error: 0, total: 0 },
                ui: { success: 0, error: 0, total: 0 }
            };
        }

        // Generar reporte
        function generateReport() {
            const resultsDiv = document.getElementById('summaryResults');
            
            const totalTests = Object.values(testResults).reduce((sum, category) => 
                sum + category.total, 0);
            const totalSuccess = Object.values(testResults).reduce((sum, category) => 
                sum + category.success, 0);
            const totalErrors = Object.values(testResults).reduce((sum, category) => 
                sum + category.error, 0);
            
            const successRate = totalTests > 0 ? ((totalSuccess / totalTests) * 100).toFixed(1) : 0;
            
            let report = `
                <div class="test-result ${successRate >= 80 ? 'success' : successRate >= 60 ? 'warning' : 'error'}">
                    <strong>📊 Reporte de Tests</strong><br>
                    <small>Fecha: ${new Date().toLocaleString()}</small>
                </div>
                <div class="test-result info">
                    <strong>Resumen General</strong><br>
                    <small>Total tests: ${totalTests} | Exitosos: ${totalSuccess} | Errores: ${totalErrors}</small><br>
                    <small>Tasa de éxito: ${successRate}%</small>
                </div>
            `;
            
            // Detalles por categoría
            Object.entries(testResults).forEach(([category, stats]) => {
                if (stats.total > 0) {
                    const categoryRate = ((stats.success / stats.total) * 100).toFixed(1);
                    const statusClass = categoryRate >= 80 ? 'success' : categoryRate >= 60 ? 'warning' : 'error';
                    
                    report += `
                        <div class="test-result ${statusClass}">
                            <strong>${category.toUpperCase()}</strong><br>
                            <small>Exitosos: ${stats.success} | Errores: ${stats.error} | Total: ${stats.total} (${categoryRate}%)</small>
                        </div>
                    `;
                }
            });
            
            // Recomendaciones
            if (successRate >= 90) {
                report += `
                    <div class="test-result success">
                        <strong>🎉 Excelente!</strong><br>
                        <small>El panel de administración está funcionando correctamente</small>
                    </div>
                `;
            } else if (successRate >= 70) {
                report += `
                    <div class="test-result warning">
                        <strong>⚠️ Atención</strong><br>
                        <small>Hay algunos problemas menores que deberían revisarse</small>
                    </div>
                `;
            } else {
                report += `
                    <div class="test-result error">
                        <strong>🚨 Crítico</strong><br>
                        <small>Hay problemas importantes que necesitan atención inmediata</small>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = report;
        }

        // Inicializar página
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Página de testing del panel de administración cargada');
            
            // Auto-test de conexión al cargar
            setTimeout(() => {
                testBackendConnection();
            }, 1000);
        });
    </script>
</body>
</html>


